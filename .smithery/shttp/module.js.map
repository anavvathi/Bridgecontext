{
  "version": 3,
  "sources": ["../../mcp-server.js"],
  "sourcesContent": ["#!/usr/bin/env node\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst os = require('os');\r\nconst { execSync } = require('child_process');\r\n\r\nfunction findExchangeFile() {\r\n    // 1. Check environment variable\r\n    if (process.env.BRIDGE_CONTEXT_EXCHANGE) return process.env.BRIDGE_CONTEXT_EXCHANGE;\r\n\r\n    // 2. Check local relative path (dev mode)\r\n    const localPath = path.join(__dirname, 'native-host', 'exchange.json');\r\n    if (fs.existsSync(localPath)) return localPath;\r\n\r\n    // 3. Windows Registry Discovery\r\n    if (process.platform === 'win32') {\r\n        try {\r\n            const hostName = 'com.bridgecontext.host';\r\n            const regBuffer = execSync(`reg query \"HKEY_CURRENT_USER\\\\Software\\\\Google\\\\Chrome\\\\NativeMessagingHosts\\\\${hostName}\" /ve`);\r\n            const regOutput = regBuffer.toString();\r\n            const match = regOutput.match(/REG_SZ\\s+(.*)/);\r\n            if (match && match[1]) {\r\n                const manifestPath = match[1].trim();\r\n                const manifest = JSON.parse(fs.readFileSync(manifestPath, 'utf8'));\r\n                if (manifest.path) {\r\n                    const exchangePath = path.join(path.dirname(manifest.path), 'exchange.json');\r\n                    if (fs.existsSync(exchangePath)) return exchangePath;\r\n                }\r\n            }\r\n        } catch (e) { /* silent fail */ }\r\n    }\r\n\r\n    // 4. Fallback to CWD\r\n    return path.join(process.cwd(), 'native-host', 'exchange.json');\r\n}\r\n\r\nconst EXCHANGE_PATH = findExchangeFile();\r\n\r\nasync function main() {\r\n    process.stderr.write('\uD83C\uDF09 BridgeContext MCP Server active\\n');\r\n\r\n    let buffer = '';\r\n    process.stdin.on('data', (chunk) => {\r\n        buffer += chunk.toString();\r\n        let eolIndex;\r\n        while ((eolIndex = buffer.indexOf('\\n')) >= 0) {\r\n            const line = buffer.slice(0, eolIndex);\r\n            buffer = buffer.slice(eolIndex + 1);\r\n            if (line.trim()) {\r\n                handleRequest(line);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction handleRequest(line) {\r\n    try {\r\n        const request = JSON.parse(line);\r\n        const { method, params, id } = request;\r\n\r\n        if (method === 'initialize') {\r\n            sendResponse(id, {\r\n                capabilities: { tools: {} },\r\n                serverInfo: { name: \"bridge-context-mcp\", version: \"1.0.0\" }\r\n            });\r\n        } else if (method === 'tools/list') {\r\n            sendResponse(id, {\r\n                tools: [{\r\n                    name: 'get_current_context',\r\n                    description: 'Retrieve the latest AI context bridged from the browser. Use this to get information the user has just researched or captured in their browser.',\r\n                    inputSchema: { type: 'object', properties: {} }\r\n                }]\r\n            });\r\n        } else if (method === 'tools/call' && params.name === 'get_current_context') {\r\n            if (fs.existsSync(EXCHANGE_PATH)) {\r\n                try {\r\n                    const content = fs.readFileSync(EXCHANGE_PATH, 'utf8');\r\n                    const pack = JSON.parse(content);\r\n                    sendResponse(id, {\r\n                        content: [{\r\n                            type: 'text',\r\n                            text: `--- BRIDGE CONTEXT ---\\nTitle: ${pack.name}\\nDescription: ${pack.desc}\\n\\nPayload:\\n${pack.data}`\r\n                        }]\r\n                    });\r\n                } catch (err) {\r\n                    sendResponse(id, {\r\n                        content: [{ type: 'text', text: 'Error reading context: ' + err.message }],\r\n                        isError: true\r\n                    });\r\n                }\r\n            } else {\r\n                sendResponse(id, {\r\n                    content: [{ type: 'text', text: 'No context available. Please bridge context from your browser first.' }]\r\n                });\r\n            }\r\n        }\r\n    } catch (e) {\r\n        // Silent catch for parse errors on half-written lines\r\n    }\r\n}\r\n\r\nfunction sendResponse(id, result) {\r\n    process.stdout.write(JSON.stringify({ jsonrpc: '2.0', id, result }) + '\\n');\r\n}\r\n\r\n// Smithery Sandbox Support\r\nfunction createSandboxServer() {\r\n    return {\r\n        connect: async () => {\r\n            process.stderr.write('\u2601\uFE0F Smithery Sandbox Connect Simulation\\n');\r\n        },\r\n        listTools: async () => {\r\n            return {\r\n                tools: [{\r\n                    name: 'get_current_context',\r\n                    description: 'Retrieve the latest AI context bridged from the browser.'\r\n                }]\r\n            };\r\n        }\r\n    };\r\n}\r\n\r\nif (require.main === module) {\r\n    main();\r\n}\r\n\r\nmodule.exports = { createSandboxServer };\r\n"],
  "mappings": "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",
  "names": ["require_mcp_server", "__commonJSMin", "exports", "module", "fs", "path", "os", "execSync", "findExchangeFile", "localPath", "match", "manifestPath", "manifest", "exchangePath", "EXCHANGE_PATH", "main", "buffer", "chunk", "eolIndex", "line", "handleRequest", "request", "method", "params", "id", "sendResponse", "content", "pack", "err", "result", "createSandboxServer", "__require"]
}
